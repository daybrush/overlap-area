{"version":3,"file":"overlap-area.cjs.js","sources":["../src/utils.ts","../src/index.ts"],"sourcesContent":["import { throttle, TINY_NUM } from \"@daybrush/utils\";\n\nexport function tinyThrottle(num: number) {\n    return throttle(num, TINY_NUM);\n}\n\nexport function isSameConstants(\n    linearConstants1: number[],\n    linearConstants2: number[],\n) {\n    return linearConstants1.every((v, i) => tinyThrottle(v - linearConstants2[i]) === 0);\n}\n\nexport function isSamePoint(\n    point1: number[],\n    point2: number[],\n) {\n    return !tinyThrottle(point1[0] - point2[0]) && !tinyThrottle(point1[1] - point2[1]);\n}\n\nexport function flat<Type extends any>(arr: Type[][]): Type[] {\n    return arr.reduce<Type[]>((prev, current) => {\n        prev.push(...current);\n        return prev;\n    }, []);\n}\n","import { sum, findIndex, getShapeDirection, getDist, throttle, TINY_NUM, find } from \"@daybrush/utils\";\nimport { OverlapPointInfo, PointInfo, Rect } from \"./types\";\nimport { flat, isSameConstants, isSamePoint, tinyThrottle } from \"./utils\";\n\n/**\n * @namespace OverlapArea\n */\n\n/**\n * Gets the size of a shape (polygon) made of points.\n * @memberof OverlapArea\n */\nexport function getAreaSize(points: number[][]): number {\n    if (points.length < 3) {\n        return 0;\n    }\n    return Math.abs(sum(points.map((point, i) => {\n        const nextPoint = points[i + 1] || points[0];\n\n        return point[0] * nextPoint[1] - nextPoint[0] * point[1];\n    }))) / 2;\n}\n\n\n/**\n * Get points that fit the rect,\n * @memberof OverlapArea\n */\nexport function fitPoints(points: number[][], rect: Rect): number[][] {\n    const { width, height, left, top } = rect;\n    const { minX, minY, maxX, maxY } = getMinMaxs(points);\n    const ratioX = width / (maxX - minX);\n    const ratioY = height / (maxY - minY);\n\n    return points.map(point => {\n        return [\n            left + (point[0] - minX) * ratioX,\n            top + (point[1] - minY) * ratioY,\n        ];\n    });\n}\n/**\n * Get the minimum and maximum points of the points.\n * @memberof OverlapArea\n */\nexport function getMinMaxs(points: number[][]): { minX: number, minY: number, maxX: number, maxY: number } {\n    const xs = points.map(point => point[0]);\n    const ys = points.map(point => point[1]);\n\n    return {\n        minX: Math.min(...xs),\n        minY: Math.min(...ys),\n        maxX: Math.max(...xs),\n        maxY: Math.max(...ys),\n    };\n}\n/**\n * Whether the point is in shape\n * @param - point pos\n * @param - shape points\n * @param - whether to check except line\n * @memberof OverlapArea\n */\nexport function isInside(pos: number[], points: number[][], excludeLine?: boolean): boolean {\n    const [x, y] = pos;\n    const {\n        minX,\n        maxX,\n    } = getMinMaxs(points);\n\n    const xLine = [[minX, y], [maxX, y]];\n    const xLinearConstants = getLinearConstants(xLine[0], xLine[1]);\n    const lines = convertLines(points);\n\n    interface IntersectionPosInfo {\n        pos: number[];\n        line: number[][];\n        type: \"intersection\" | \"point\" | \"line\";\n    }\n    const intersectionPosInfos: IntersectionPosInfo[] = [];\n\n    lines.forEach(line => {\n        const linearConstants = getLinearConstants(line[0], line[1]);\n        const standardPoint = line[0];\n\n        if (isSameConstants(xLinearConstants, linearConstants)) {\n            intersectionPosInfos.push({\n                pos: pos,\n                line,\n                type: \"line\",\n            });\n        } else {\n            const xPoints = getPointsOnLines(getIntersectionPointsByConstants(xLinearConstants, linearConstants), [xLine, line]);\n\n            xPoints.forEach(point => {\n                if (line.some(linePoint => isSamePoint(linePoint, point))) {\n                    intersectionPosInfos.push({\n                        pos: point,\n                        line,\n                        type: \"point\",\n                    });\n                } else if (tinyThrottle(standardPoint[1] - y) !== 0) {\n                    intersectionPosInfos.push({\n                        pos: point,\n                        line,\n                        type: \"intersection\",\n                    });\n                }\n            })\n        }\n    });\n\n    if (!excludeLine) {\n        // on line\n        if (find(intersectionPosInfos, p => p[0] === x)) {\n            return true;\n        }\n    }\n    let intersectionCount = 0;\n    const xMap = {};\n\n    intersectionPosInfos.forEach(({ pos, type, line }) => {\n        if (pos[0] > x) {\n            return;\n        }\n        if (type === \"intersection\") {\n            ++intersectionCount;\n        } else if (type === \"line\") {\n            return;\n        } else if (type === \"point\") {\n            const point = find(line, linePoint => linePoint[1] !== y);\n            const prevValue = xMap[pos[0]];\n            const nextValue = point[1] > y ? 1 : -1;\n\n            if (!prevValue) {\n                xMap[pos[0]] = nextValue;\n            } else if (prevValue !== nextValue) {\n                ++intersectionCount;\n            }\n        }\n    });\n    return intersectionCount % 2 === 1;\n}\n/**\n * Get distance from point to constants. [a, b, c] (ax + by + c = 0)\n * @return [a, b, c]\n * @memberof OverlapArea\n */\nexport function getDistanceFromPointToConstants(\n    [a, b, c]: [number, number, number],\n    pos: number[],\n) {\n    return (a * pos[0] + b * pos[1] + c) / (a * a + b * b);\n}\n\n/**\n * Get the coefficient of the linear function. [a, b, c] (ax + by + c = 0)\n * @return [a, b, c]\n * @memberof OverlapArea\n */\nexport function getLinearConstants(point1: number[], point2: number[]): [number, number, number] {\n    const [x1, y1] = point1;\n    const [x2, y2] = point2;\n    // ax + by + c = 0\n    // [a, b, c]\n    let dx = x2 - x1;\n    let dy = y2 - y1;\n\n    if (Math.abs(dx) < TINY_NUM) {\n        dx = 0;\n    }\n    if (Math.abs(dy) < TINY_NUM) {\n        dy = 0;\n    }\n\n    // b > 0\n    // ax + by + c = 0\n    let a = 0;\n    let b = 0;\n    let c = 0;\n    if (!dx) {\n        if (dy) {\n            // -x + 1 = 0\n            a = -1;\n            c = x1;\n        }\n    } else if (!dy) {\n        // y - 1 = 0\n        b = 1;\n        c = -y1;\n    } else {\n        // y = -a(x - x1) + y1\n        // ax + y + a * x1 - y1 = 0\n        a = -dy / dx;\n        b = 1;\n        c = -a * x1 - y1;\n    }\n\n    return [a, b, c] as [number, number, number];\n}\n/**\n * Get intersection points with linear functions.\n * @memberof OverlapArea\n */\nexport function getIntersectionPointsByConstants(\n    linearConstants1: number[],\n    linearConstants2: number[],\n): number[][] {\n    const [a1, b1, c1] = linearConstants1;\n    const [a2, b2, c2] = linearConstants2;\n\n    const isZeroA = a1 === 0 && a2 === 0;\n    const isZeroB = b1 === 0 && b2 === 0;\n    let results: number[][] = [];\n\n    if (isZeroA && isZeroB) {\n        return [];\n    } else if (isZeroA) {\n        // b1 * y + c1 = 0\n        // b2 * y + c2 = 0\n        const y1 = -c1 / b1;\n        const y2 = -c2 / b2;\n\n        if (y1 !== y2) {\n            return [];\n        } else {\n            return [\n                [-Infinity, y1],\n                [Infinity, y1],\n            ];\n        }\n    } else if (isZeroB) {\n        // a1 * x + c1 = 0\n        // a2 * x + c2 = 0\n        const x1 = -c1 / a1;\n        const x2 = -c2 / a2;\n\n        if (x1 !== x2) {\n            return [];\n        } else {\n            return [\n                [x1, -Infinity],\n                [x1, Infinity],\n            ];\n        }\n    } else if (a1 === 0) {\n        // b1 * y + c1 = 0\n        // y = - c1 / b1;\n        // a2 * x + b2 * y + c2 = 0\n        const y = -c1 / b1;\n        const x = -(b2 * y + c2) / a2;\n\n        results = [[x, y]];\n    } else if (a2 === 0) {\n        // b2 * y + c2 = 0\n        // y = - c2 / b2;\n        // a1 * x + b1 * y + c1 = 0\n        const y = -c2 / b2;\n        const x = -(b1 * y + c1) / a1;\n\n        results = [[x, y]];\n    } else if (b1 === 0) {\n        // a1 * x + c1 = 0\n        // x = - c1 / a1;\n        // a2 * x + b2 * y + c2 = 0\n        const x = - c1 / a1;\n        const y = -(a2 * x + c2) / b2;\n\n        results = [[x, y]];\n    } else if (b2 === 0) {\n        // a2 * x + c2 = 0\n        // x = - c2 / a2;\n        // a1 * x + b1 * y + c1 = 0\n        const x = - c2 / a2;\n        const y = -(a1 * x + c1) / b1;\n\n        results = [[x, y]];\n    } else {\n        // a1 * x + b1 * y + c1 = 0\n        // a2 * x + b2 * y + c2 = 0\n        // b2 * a1 * x + b2 * b1 * y + b2 * c1 = 0\n        // b1 * a2 * x + b1 * b2 * y + b1 * c2 = 0\n        // (b2 * a1 - b1 * a2)  * x = (b1 * c2 - b2 * c1)\n        const x = (b1 * c2 - b2 * c1) / (b2 * a1 - b1 * a2);\n        const y = -(a1 * x + c1) / b1;\n\n        results = [[x, y]];\n    }\n\n    return results.map(result => [result[0], result[1]]);\n}\n/**\n * Get intersection points to the two lines.\n * @memberof OverlapArea\n */\nexport function getIntersectionPoints(\n    line1: number[][],\n    line2: number[][],\n    isLimit?: boolean,\n): number[][] {\n    const points = getIntersectionPointsByConstants(\n        getLinearConstants(line1[0], line1[1]),\n        getLinearConstants(line2[0], line2[1]),\n    );\n\n    if (isLimit) {\n        return getPointsOnLines(points, [line1, line2]);\n    }\n    return points;\n}\n\nexport function isPointOnLine(\n    pos: number[],\n    line: number[][],\n) {\n    const linearConstants = getLinearConstants(line[0], line[1]);\n\n    return tinyThrottle(getDistanceFromPointToConstants(linearConstants, pos)) === 0;\n}\n\n/**\n * Get the points on the lines (between two points).\n * @memberof OverlapArea\n */\nexport function getPointsOnLines(\n    points: number[][],\n    lines: number[][][],\n): number[][] {\n    const minMaxs = lines.map(line => [0, 1].map(order => [\n        Math.min(line[0][order], line[1][order]),\n        Math.max(line[0][order], line[1][order]),\n    ]));\n    let results: number[][] = [];\n\n    if (points.length === 2) {\n        const [x, y] = points[0];\n        if (!tinyThrottle(x - points[1][0])) {\n            /// Math.max(minY1, minY2)\n            const top = Math.max(...minMaxs.map(minMax => minMax[1][0]));\n            /// Math.min(maxY1, miax2)\n            const bottom = Math.min(...minMaxs.map(minMax => minMax[1][1]));\n\n            if (tinyThrottle(top - bottom) > 0) {\n                return [];\n            }\n            results = [\n                [x, top],\n                [x, bottom],\n            ];\n        } else if (!tinyThrottle(y - points[1][1])) {\n            /// Math.max(minY1, minY2)\n            const left = Math.max(...minMaxs.map(minMax => minMax[0][0]));\n            /// Math.min(maxY1, miax2)\n            const right = Math.min(...minMaxs.map(minMax => minMax[0][1]));\n\n            if (tinyThrottle(left - right) > 0) {\n                return [];\n            }\n            results = [\n                [left, y],\n                [right, y],\n            ];\n        }\n    }\n\n    if (!results.length) {\n        results = points.filter(point => {\n            const [pointX, pointY] = point;\n\n            return minMaxs.every(minMax => {\n                return (0 <= tinyThrottle(pointX - minMax[0][0]) && 0 <= tinyThrottle(minMax[0][1] - pointX))\n                && (0 <= tinyThrottle(pointY - minMax[1][0]) && 0 <= tinyThrottle(minMax[1][1] - pointY));\n            });\n        });\n    }\n\n    return results.map(result => [tinyThrottle(result[0]), tinyThrottle(result[1])]);\n\n}\n/**\n* Convert two points into lines.\n* @function\n* @memberof OverlapArea\n*/\nexport function convertLines(points: number[][]): number[][][] {\n    return [...points.slice(1), points[0]].map((point, i) => [points[i], point]);\n}\n\nfunction getOverlapPointInfos(points1: number[][], points2: number[][]): OverlapPointInfo[] {\n    const targetPoints1 = points1.slice();\n    const targetPoints2 = points2.slice();\n\n    if (getShapeDirection(targetPoints1) === -1) {\n        targetPoints1.reverse();\n    }\n    if (getShapeDirection(targetPoints2) === -1) {\n        targetPoints2.reverse();\n    }\n    const lines1 = convertLines(targetPoints1);\n    const lines2 = convertLines(targetPoints2);\n    const linearConstantsList1 = lines1.map(line1 => getLinearConstants(line1[0], line1[1]));\n    const linearConstantsList2 = lines2.map(line2 => getLinearConstants(line2[0], line2[1]));\n\n    const overlapInfos: OverlapPointInfo[] = [];\n\n    linearConstantsList1.forEach((linearConstants1, i) => {\n        const line1 = lines1[i];\n        const linePointInfos: OverlapPointInfo[] = [];\n        linearConstantsList2.forEach((linearConstants2, j) => {\n            const intersectionPoints = getIntersectionPointsByConstants(linearConstants1, linearConstants2);\n            const points = getPointsOnLines(intersectionPoints, [line1, lines2[j]]);\n\n            linePointInfos.push(...points.map(pos => ({\n                index1: i,\n                index2: j,\n                pos,\n                type: \"intersection\" as const,\n            })));\n        });\n        linePointInfos.sort((a, b) => {\n            return getDist(line1[0], a.pos) - getDist(line1[0], b.pos);\n        });\n\n        overlapInfos.push(...linePointInfos);\n\n        if (isInside(line1[1], targetPoints2)) {\n            overlapInfos.push({\n                index1: i,\n                index2: -1,\n                pos: line1[1],\n                type: \"inside\" as const,\n            });\n        }\n    });\n\n    lines2.forEach((line2, i) => {\n        if (!isInside(line2[1], targetPoints1)) {\n            return;\n        }\n        let isNext = false;\n        let index = findIndex(overlapInfos, ({ index2 }) => {\n            if (index2 === i) {\n                isNext = true;\n                return false;\n            }\n\n            if (isNext) {\n                return true;\n            }\n            return false;\n        });\n        if (index === -1) {\n            isNext = false;\n            index = findIndex(overlapInfos, ({ index1, index2 }) => {\n                if (index1 === -1 && index2 + 1 === i) {\n                    isNext = true;\n                    return false;\n                }\n\n                if (isNext) {\n                    return true;\n                }\n                return false;\n            });\n        }\n        if (index === -1) {\n            overlapInfos.push({\n                index1: -1,\n                index2: i,\n                pos: line2[1],\n                type: \"inside\" as const,\n            });\n        } else {\n            overlapInfos.splice(index, 0, {\n                index1: -1,\n                index2: i,\n                pos: line2[1],\n                type: \"inside\" as const,\n            });\n\n        }\n    });\n    const pointMap: Record<string, boolean> = {};\n\n    return overlapInfos.filter(({ pos }) => {\n        const key = `${pos[0]}x${pos[1]}`;\n\n        if (pointMap[key]) {\n            return false;\n        }\n        pointMap[key] = true;\n        return true;\n    });\n}\n\n/**\n* Get the points of the overlapped part of two shapes.\n* @function\n* @memberof OverlapArea\n*/\nexport function getOverlapPoints(points1: number[][], points2: number[][]): number[][] {\n    const infos = getOverlapPointInfos(points1, points2);\n\n    return infos.map(({ pos }) => pos);\n}\n\nfunction isConnectedLine(line: OverlapPointInfo[]) {\n    const {\n        0: {\n            index1: prevIndex1,\n            index2: prevIndex2,\n        },\n        1: {\n            index1: nextIndex1,\n            index2: nextIndex2,\n        }\n    } = line;\n\n    if (prevIndex1 !== -1) {\n        // same line\n        if (prevIndex1 === nextIndex1) {\n            return true;\n        }\n        if (prevIndex1 + 1 === nextIndex1) {\n            return true;\n        }\n    }\n    if (prevIndex2 !== -1) {\n        // same line\n        if (prevIndex2 === nextIndex2) {\n            return true;\n        }\n        if (prevIndex2 + 1 === nextIndex2) {\n            return true;\n        }\n    }\n\n    return false;\n\n}\n/**\n* Get the areas of the overlapped part of two shapes.\n* @function\n* @memberof OverlapArea\n*/\nexport function getOverlapAreas(points1: number[][], points2: number[][]): number[][][] {\n    const infos = getOverlapPointInfos(points1, points2);\n    const areas: OverlapPointInfo[][] = [];\n    let area: OverlapPointInfo[];\n\n    getOverlapPointInfos(points1, points2).forEach((info, i, arr) => {\n        if (i === 0 || !isConnectedLine([arr[i - 1], info])) {\n            area = [info];\n            areas.push(area);\n        } else {\n            area.push(info);\n        }\n    });\n\n    return areas.map(area => area.map(({ pos }) => pos));\n}\nfunction findReversedAreas(points1: number[][], points2: number[][], index: number = 0, areas: number[][][] = []): number[][][] {\n    const isFirst = areas.length === 0;\n    const length = points1.length;\n    const nextIndex = points1[index] ? index : 0;\n    const nextPoints1 = [...points1.slice(nextIndex), ...points1.slice(0, nextIndex)];\n\n    for (let i = 0; i < length; ++i) {\n        const point1 = nextPoints1[i];\n\n        if (find(points2, point2 => point2[0] === point1[0] && point2[1] === point1[1])) {\n            continue;\n        }\n        if (areas.some(nextArea => find(nextArea, areaPoint => areaPoint[0] === point1[0] && areaPoint[1] === point1[1]))) {\n            if (isFirst) {\n                continue;\n            } else {\n                break;\n            }\n        }\n        let nextArea: number[][];\n\n        if (isFirst) {\n            nextArea = [];\n            areas.push(nextArea);\n        } else {\n            nextArea = areas[areas.length - 1];\n        }\n        nextArea.push(point1);\n\n\n        const line = [point1, points1[index + 1] || points1[0]];\n        const nextPoint2 = points2.filter(point2 => {\n            return isPointOnLine(point2, line);\n        }).sort((a, b) => {\n            return getDist(point1, a) - getDist(point1, b);\n        })[0];\n\n        if (!nextPoint2) {\n            findReversedAreas(nextPoints1, points2, i + 1, areas);\n            break;\n        } else {\n            const point2Index = points2.indexOf(nextPoint2);\n\n            findReversedAreas(points2, points1, point2Index, areas);\n            if (!isFirst) {\n                break;\n            }\n        }\n    }\n    return areas;\n}\nexport function findConnectedAreas(points1: number[][], points2: number[][]) {\n    return findReversedAreas(points1, [...points2].reverse());\n}\n/**\n* Get non-overlapping areas of two shapes based on points1.\n* @memberof OverlapArea\n*/\nexport function getUnoverlapAreas(points1: number[][], points2: number[][]): number[][][] {\n    if (!points2.length) {\n        return [[...points1]];\n    }\n    const overlapAreas = getOverlapAreas(points1, points2);\n     let unoverlapAreas = [points1];\n\n    overlapAreas.forEach(overlapArea => {\n        const nextOverlapArea = [...overlapArea].reverse();\n\n        unoverlapAreas = flat(unoverlapAreas.map(area => {\n            const connectedAreas = findReversedAreas(area, nextOverlapArea);\n            const firstConnectedArea = connectedAreas[0];\n\n            if (connectedAreas.length === 1 && nextOverlapArea.every(point => firstConnectedArea.indexOf(point) === -1)) {\n                const lastPoint = firstConnectedArea[firstConnectedArea.length - 1];\n                const firstPoint = [...nextOverlapArea].sort((a, b) => {\n                    return getDist(lastPoint, a) - getDist(lastPoint, b);\n                })[0];\n                const firstIndex = nextOverlapArea.indexOf(firstPoint);\n\n                firstConnectedArea.push(\n                    ...nextOverlapArea.slice(firstIndex),\n                    ...nextOverlapArea.slice(0, firstIndex),\n                    nextOverlapArea[firstIndex],\n                    lastPoint,\n                );\n            }\n            return connectedAreas;\n        }));\n    });\n\n    return unoverlapAreas;\n}\n/**\n* Gets the size of the overlapped part of two shapes.\n* @function\n* @memberof OverlapArea\n*/\nexport function getOverlapSize(points1: number[][], points2: number[][]): number {\n    const points = getOverlapPoints(points1, points2);\n\n    return getAreaSize(points);\n}\n"],"names":["tinyThrottle","num","throttle","TINY_NUM","isSameConstants","linearConstants1","linearConstants2","every","v","i","isSamePoint","point1","point2","flat","arr","reduce","prev","current","push","getAreaSize","points","length","Math","abs","sum","map","point","nextPoint","fitPoints","rect","width","height","left","top","_a","getMinMaxs","minX","minY","maxX","maxY","ratioX","ratioY","xs","ys","min","max","isInside","pos","excludeLine","x","y","xLine","xLinearConstants","getLinearConstants","lines","convertLines","intersectionPosInfos","forEach","line","linearConstants","standardPoint","type","xPoints","getPointsOnLines","getIntersectionPointsByConstants","some","linePoint","find","p","intersectionCount","xMap","prevValue","nextValue","getDistanceFromPointToConstants","a","b","c","x1","y1","x2","y2","dx","dy","a1","b1","c1","a2","b2","c2","isZeroA","isZeroB","results","Infinity","result","getIntersectionPoints","line1","line2","isLimit","isPointOnLine","minMaxs","order","minMax","bottom","right","filter","pointX","pointY","__spreadArrays","slice","getOverlapPointInfos","points1","points2","targetPoints1","targetPoints2","getShapeDirection","reverse","lines1","lines2","linearConstantsList1","linearConstantsList2","overlapInfos","linePointInfos","j","intersectionPoints","index1","index2","sort","getDist","isNext","index","findIndex","splice","pointMap","key","getOverlapPoints","infos","isConnectedLine","prevIndex1","prevIndex2","_b","nextIndex1","nextIndex2","getOverlapAreas","areas","area","info","findReversedAreas","isFirst","nextIndex","nextPoints1","nextArea","areaPoint","nextPoint2","point2Index","indexOf","findConnectedAreas","getUnoverlapAreas","overlapAreas","unoverlapAreas","overlapArea","nextOverlapArea","connectedAreas","firstConnectedArea","lastPoint_1","firstPoint","firstIndex","getOverlapSize"],"mappings":"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"}