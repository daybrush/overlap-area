{"version":3,"file":"overlap-area.js","sources":["../src/utils.ts","../src/index.ts"],"sourcesContent":["import { throttle, TINY_NUM } from \"@daybrush/utils\";\n\nexport function tinyThrottle(num: number) {\n    return throttle(num, TINY_NUM);\n}\n","import { sum, findIndex, getShapeDirection, getDist, throttle, TINY_NUM } from \"@daybrush/utils\";\nimport { PointInfo, Rect } from \"./types\";\nimport { tinyThrottle } from \"./utils\";\n\n/**\n * @namespace OverlapArea\n */\n\n/**\n * Gets the size of a shape (polygon) made of points.\n * @memberof OverlapArea\n */\nexport function getAreaSize(points: number[][]): number {\n    if (points.length < 3) {\n        return 0;\n    }\n    return Math.abs(sum(points.map((point, i) => {\n        const nextPoint = points[i + 1] || points[0];\n\n        return point[0] * nextPoint[1] - nextPoint[0] * point[1];\n    }))) / 2;\n}\n\n\n/**\n * Get points that fit the rect,\n * @memberof OverlapArea\n */\nexport function fitPoints(points: number[][], rect: Rect): number[][] {\n    const { width, height, left, top } = rect;\n    const { minX, minY, maxX, maxY } = getMinMaxs(points);\n    const ratioX = width / (maxX - minX);\n    const ratioY = height / (maxY - minY);\n\n    return points.map(point => {\n        return [\n            left + (point[0] - minX) * ratioX,\n            top + (point[1] - minY) * ratioY,\n        ];\n    });\n}\n/**\n * Get the minimum and maximum points of the points.\n * @memberof OverlapArea\n */\nexport function getMinMaxs(points: number[][]): { minX: number, minY: number, maxX: number, maxY: number } {\n    const xs = points.map(point => point[0]);\n    const ys = points.map(point => point[1]);\n\n    return {\n        minX: Math.min(...xs),\n        minY: Math.min(...ys),\n        maxX: Math.max(...xs),\n        maxY: Math.max(...ys),\n    };\n}\n/**\n * Whether the point is in shape\n * @param - point pos\n * @param - shape points\n * @param - whether to check except line\n * @memberof OverlapArea\n */\nexport function isInside(pos: number[], points: number[][], excludeLine?: boolean): boolean {\n    const [x, y] = pos;\n    const {\n        minX,\n        minY,\n        maxX,\n        maxY,\n    } = getMinMaxs(points);\n\n    const xLine = [[minX, y], [maxX, y]];\n    const yLine = [[x, minY], [x, maxY]];\n    const xLinearConstants = getLinearConstants(xLine[0], xLine[1]);\n    const yLinearConstants = getLinearConstants(yLine[0], yLine[1]);\n    const lines = convertLines(points);\n    const intersectionXPoints: number[][] = [];\n    const intersectionYPoints: number[][] = [];\n\n    lines.forEach(line => {\n        const linearConstants = getLinearConstants(line[0], line[1]);\n        const xPoints = getPointsOnLines(getIntersectionPointsByConstants(xLinearConstants, linearConstants), [xLine, line]);\n        const yPoints = getPointsOnLines(getIntersectionPointsByConstants(yLinearConstants, linearConstants), [yLine, line]);\n\n        if (xPoints.length === 1 ? line[0][1] !== y : true) {\n            intersectionXPoints.push(...xPoints);\n        }\n        if (yPoints.length === 1 ? line[0][0] !== x : true) {\n            intersectionYPoints.push(...yPoints);\n        }\n\n        if (!linearConstants[0]) {\n            intersectionXPoints.push(...xPoints);\n        }\n        if (!linearConstants[1]) {\n            intersectionYPoints.push(...yPoints);\n        }\n    });\n\n    if (!excludeLine) {\n        if (\n            findIndex(intersectionXPoints, p => p[0] === x) > -1\n            || findIndex(intersectionYPoints, p => p[1] === y) > -1\n        ) {\n            return true;\n        }\n    }\n    if (\n        (intersectionXPoints.filter(p => p[0] > x).length % 2)\n        && (intersectionYPoints.filter(p => p[1] > y).length % 2)\n    ) {\n        return true;\n    }\n    return false;\n}\n\n/**\n * Get the coefficient of the linear function. [a, b, c] (ax + by + c = 0)\n * @return [a, b, c]\n * @memberof OverlapArea\n */\nexport function getLinearConstants(point1: number[], point2: number[]): [number, number, number] {\n    const [x1, y1] = point1;\n    const [x2, y2] = point2;\n    // ax + by + c = 0\n    // [a, b, c]\n    let a = 0;\n    let b = 0;\n    let c = 0;\n\n    if (x1 === x2 && y1 === y2) {\n        return [0, 0, 0];\n    } if (x1 === x2) {\n        // x = x1\n        return [1, 0, -x1];\n    } else if (y1 === y2) {\n        // y = y1\n        return [0, 1, -y1];\n    } else {\n        // x1 + a * y1 + b = 0\n        // x2 + a * y2 + b = 0\n        // (x1 -x2) + (y1 - y2) * a = 0\n        // a = (x2 - x1) / (y1 - y2)\n        // x1 + (x2 - x1) / (y1 - y2)\n\n        const a = (x2 - x1) / (y1 - y2);\n        const b = -x1 - a * y1;\n        return [1, a, b];\n    }\n}\n/**\n * Get intersection points with linear functions.\n * @memberof OverlapArea\n */\nexport function getIntersectionPointsByConstants(\n    linearConstants1: number[],\n    linearConstants2: number[],\n): number[][] {\n    const [a1, b1, c1] = linearConstants1;\n    const [a2, b2, c2] = linearConstants2;\n\n    const isZeroA = a1 === 0 && a2 === 0;\n    const isZeroB = b1 === 0 && b2 === 0;\n    let results: number[][] = [];\n\n    if (isZeroA && isZeroB) {\n        return [];\n    } else if (isZeroA) {\n        // b1 * y + c1 = 0\n        // b2 * y + c2 = 0\n        const y1 = -c1 / b1;\n        const y2 = -c2 / b2;\n\n        if (y1 !== y2) {\n            return [];\n        } else {\n            return [\n                [-Infinity, tinyThrottle(y1)],\n                [Infinity, tinyThrottle(y1)],\n            ];\n        }\n    } else if (isZeroB) {\n        // a1 * x + c1 = 0\n        // a2 * x + c2 = 0\n        const x1 = -c1 / a1;\n        const x2 = -c2 / a2;\n\n        if (x1 !== x2) {\n            return [];\n        } else {\n            return [\n                [tinyThrottle(x1), -Infinity],\n                [tinyThrottle(x1), Infinity],\n            ];\n        }\n    } else if (a1 === 0) {\n        // b1 * y + c1 = 0\n        // y = - c1 / b1;\n        // a2 * x + b2 * y + c2 = 0\n        const y = -c1 / b1;\n        const x = -(b2 * y + c2) / a2;\n\n        results = [[x, y]];\n    } else if (a2 === 0) {\n        // b2 * y + c2 = 0\n        // y = - c2 / b2;\n        // a1 * x + b1 * y + c1 = 0\n        const y = -c2 / b2;\n        const x = -(b1 * y + c1) / a1;\n\n        results = [[x, y]];\n    } else if (b1 === 0) {\n        // a1 * x + c1 = 0\n        // x = - c1 / a1;\n        // a2 * x + b2 * y + c2 = 0\n        const x = - c1 / a1;\n        const y = -(a2 * x + c2) / b2;\n\n        results = [[x, y]];\n    } else if (b2 === 0) {\n        // a2 * x + c2 = 0\n        // x = - c2 / a2;\n        // a1 * x + b1 * y + c1 = 0\n        const x = - c2 / a2;\n        const y = -(a1 * x + c1) / b1;\n\n        results = [[x, y]];\n    } else {\n        // a1 * x + b1 * y + c1 = 0\n        // a2 * x + b2 * y + c2 = 0\n        // b2 * a1 * x + b2 * b1 * y + b2 * c1 = 0\n        // b1 * a2 * x + b1 * b2 * y + b1 * c2 = 0\n        // (b2 * a1 - b1 * a2)  * x = (b1 * c2 - b2 * c1)\n        const x = (b1 * c2 - b2 * c1) / (b2 * a1 - b1 * a2);\n        const y = -(a1 * x + c1) / b1;\n\n        results = [[x, y]];\n    }\n\n    return results.map(result => [tinyThrottle(result[0]), tinyThrottle(result[1])]);\n}\n/**\n * Get intersection points to the two lines.\n * @memberof OverlapArea\n */\nexport function getIntersectionPoints(\n    line1: number[][],\n    line2: number[][],\n    isLimit?: boolean,\n): number[][] {\n    const points = getIntersectionPointsByConstants(\n        getLinearConstants(line1[0], line1[1]),\n        getLinearConstants(line2[0], line2[1]),\n    );\n\n    if (isLimit) {\n        return getPointsOnLines(points, [line1, line2]);\n    }\n    return points;\n}\n/**\n * Get the points on the lines (between two points).\n * @memberof OverlapArea\n */\nexport function getPointsOnLines(\n    points: number[][],\n    lines: number[][][],\n): number[][] {\n    const minMaxs = lines.map(line => [0, 1].map(order => [\n        Math.min(line[0][order], line[1][order]),\n        Math.max(line[0][order], line[1][order]),\n    ]));\n    let results: number[][] = [];\n\n    if (points.length === 2) {\n        const [x, y] = points[0];\n        if (x === points[1][0]) {\n            /// Math.max(minY1, minY2)\n            const top = Math.max(...minMaxs.map(minMax => minMax[1][0]));\n            /// Math.min(maxY1, miax2)\n            const bottom = Math.min(...minMaxs.map(minMax => minMax[1][1]));\n\n            if (tinyThrottle(top - bottom) > 0) {\n                return [];\n            }\n            results = [\n                [x, top],\n                [x, bottom],\n            ];\n        } else if (y === points[1][1]) {\n            /// Math.max(minY1, minY2)\n            const left = Math.max(...minMaxs.map(minMax => minMax[0][0]));\n            /// Math.min(maxY1, miax2)\n            const right = Math.min(...minMaxs.map(minMax => minMax[0][1]));\n\n            if (tinyThrottle(left - right) > 0) {\n                return [];\n            }\n            results = [\n                [left, y],\n                [right, y],\n            ];\n        }\n    }\n\n    if (!results.length) {\n        results = points.filter(point => {\n            return minMaxs.every(minMax => {\n                return (minMax[0][0] <= point[0] && point[0] <= minMax[0][1])\n                    && (minMax[1][0] <= point[1] && point[1] <= minMax[1][1]);\n            });\n        });\n    }\n\n    return results.map(result => [tinyThrottle(result[0]), tinyThrottle(result[1])]);\n\n}\n/**\n* Convert two points into lines.\n* @function\n* @memberof OverlapArea\n*/\nexport function convertLines(points: number[][]): number[][][] {\n    return [...points.slice(1), points[0]].map((point, i) => [points[i], point]);\n}\n/**\n* Get the points of the overlapped part of two shapes.\n* @function\n* @memberof OverlapArea\n*/\nexport function getOverlapPoints(points1: number[][], points2: number[][]): number[][] {\n    const targetPoints1 = points1.slice();\n    const targetPoints2 = points2.slice();\n\n    if (getShapeDirection(targetPoints1) === -1) {\n        targetPoints1.reverse();\n    }\n    if (getShapeDirection(targetPoints2) === -1) {\n        targetPoints2.reverse();\n    }\n    const lines1 = convertLines(targetPoints1);\n    const lines2 = convertLines(targetPoints2);\n    const linearConstantsList1 = lines1.map(line1 => getLinearConstants(line1[0], line1[1]));\n    const linearConstantsList2 = lines2.map(line2 => getLinearConstants(line2[0], line2[1]));\n\n    const overlapInfos: Array<{\n        index1: number;\n        index2: number;\n        pos: number[];\n    }> = [];\n\n    linearConstantsList1.forEach((linearConstants1, i) => {\n        const line1 = lines1[i];\n        const linePointInfos: PointInfo[] = [];\n        linearConstantsList2.forEach((linearConstants2, j) => {\n            const intersectionPoints = getIntersectionPointsByConstants(linearConstants1, linearConstants2);\n            const points = getPointsOnLines(intersectionPoints, [line1, lines2[j]]);\n\n            linePointInfos.push(...points.map(pos => ({\n                index1: i,\n                index2: j,\n                pos,\n            })));\n        });\n        linePointInfos.sort((a, b) => {\n            return getDist(line1[0], a.pos) - getDist(line1[0], b.pos);\n        });\n\n        overlapInfos.push(...linePointInfos);\n\n        if (isInside(line1[1], targetPoints2)) {\n            overlapInfos.push({\n                index1: i,\n                index2: -1,\n                pos: line1[1],\n            });\n        }\n    });\n\n    lines2.forEach((line2, i) => {\n        if (isInside(line2[1], targetPoints1)) {\n            let isNext = false;\n            let index = findIndex(overlapInfos, ({ index2 }) => {\n                if (index2 === i) {\n                    isNext = true;\n                    return false;\n                }\n\n                if (isNext) {\n                    return true;\n                }\n                return false;\n            });\n            if (index === -1) {\n                isNext = false;\n                index = findIndex(overlapInfos, ({ index1, index2 }) => {\n                    if (index1 === -1 && index2 + 1 === i) {\n                        isNext = true;\n                        return false;\n                    }\n\n                    if (isNext) {\n                        return true;\n                    }\n                    return false;\n                });\n            }\n            if (index === -1) {\n                overlapInfos.push({\n                    index1: -1,\n                    index2: i,\n                    pos: line2[1],\n                });\n            } else {\n                overlapInfos.splice(index, 0, {\n                    index1: -1,\n                    index2: i,\n                    pos: line2[1],\n                });\n            }\n        }\n    });\n    // console.log(overlapInfos);\n    const overlapPoints = overlapInfos.map(({ pos }) => pos);\n    const pointMap: Record<string, boolean> = {};\n\n    return overlapPoints.filter(point => {\n        const key = `${point[0]}x${point[1]}`;\n\n        if (pointMap[key]) {\n            return false;\n        }\n        pointMap[key] = true;\n        return true;\n    });\n}\n/**\n* Gets the size of the overlapped part of two shapes.\n* @function\n* @memberof OverlapArea\n*/\nexport function getOverlapSize(points1: number[][], points2: number[][]): number {\n    const points = getOverlapPoints(points1, points2);\n\n    return getAreaSize(points);\n}\n"],"names":["tinyThrottle","num","throttle","TINY_NUM","getAreaSize","points","length","Math","abs","sum","map","point","i","nextPoint","fitPoints","rect","width","height","left","top","_a","getMinMaxs","minX","minY","maxX","maxY","ratioX","ratioY","xs","ys","min","max","isInside","pos","excludeLine","x","y","xLine","yLine","xLinearConstants","getLinearConstants","yLinearConstants","lines","convertLines","intersectionXPoints","intersectionYPoints","forEach","line","linearConstants","xPoints","getPointsOnLines","getIntersectionPointsByConstants","yPoints","push","findIndex","p","filter","point1","point2","x1","y1","x2","y2","a_1","b_1","linearConstants1","linearConstants2","a1","b1","c1","a2","b2","c2","isZeroA","isZeroB","results","Infinity","result","getIntersectionPoints","line1","line2","isLimit","minMaxs","order","minMax","bottom","right","every","__spreadArrays","slice","getOverlapPoints","points1","points2","targetPoints1","targetPoints2","getShapeDirection","reverse","lines1","lines2","linearConstantsList1","linearConstantsList2","overlapInfos","linePointInfos","j","intersectionPoints","index1","index2","sort","a","b","getDist","isNext_1","index","splice","overlapPoints","pointMap","key","getOverlapSize"],"mappings":"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"}